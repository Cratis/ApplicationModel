<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
    <PropertyGroup>
        <TargetFrameworkFolder Condition=" '$(TargetFramework)' == 'net8.0' ">net8.0</TargetFrameworkFolder>
        <TargetFrameworkFolder Condition=" '$(TargetFramework)' == 'net9.0' ">net9.0</TargetFrameworkFolder>

        <CratisProxyDevAssemblyDirectory>$(MSBuildThisFileDirectory)../../ProxyGenerator/bin/$(Configuration)/$(TargetFrameworkFolder)</CratisProxyDevAssemblyDirectory>
        <CratisProxyPackedAssemblyDirectory>$(MSBuildThisFileDirectory)../tasks/$(TargetFrameworkFolder)</CratisProxyPackedAssemblyDirectory>

        <CratisProxyGeneratorAssemblyDirectory Condition="Exists($(CratisProxyPackedAssemblyDirectory)) == true">$(CratisProxyPackedAssemblyDirectory)</CratisProxyGeneratorAssemblyDirectory>
        <CratisProxyGeneratorAssemblyDirectory Condition="Exists($(CratisProxyPackedAssemblyDirectory)) == false">$(CratisProxyDevAssemblyDirectory)</CratisProxyGeneratorAssemblyDirectory>
        <CratisProxyGeneratorAssembly>Cratis.Applications.ProxyGenerator.dll</CratisProxyGeneratorAssembly>
    </PropertyGroup>

    <Target Name="CratisProxyGenerator" AfterTargets="AfterBuild">
        <Message Text="Working directory : $(CratisProxyGeneratorAssemblyDirectory)" Importance="high" />
        <Message Text="TargetFramework : $(TargetFramework)" Importance="high" />
        <Exec Command="dotnet $(CratisProxyGeneratorAssembly) $(MSBuildProjectDirectory)/$(OutputPath)/$(AssemblyName).dll $(CratisProxiesOutputPath) $(CratisProxiesSegmentsToSkip)" WorkingDirectory="$(CratisProxyGeneratorAssemblyDirectory)" />
    </Target>
</Project>
